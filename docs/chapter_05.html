<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Practice R Tutorials - 4&nbsp; Prepare categorical variables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_06.html" rel="next">
<link href="./chapter_04.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head><body class="nav-sidebar floating nav-fixed"><div id="progress-bar" style="width: 0%; height:2px; background-color: rgb(89 127 235);; position: fixed; top: 0px; z-index: 2000;"></div>

<script id="progressbar" type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {

    const bar = document.querySelector('#progress-bar');
    const post = document.querySelector('#quarto-content');
    const html = document.documentElement;
    
    const height = post.scrollHeight + post.offsetTop;
    
    window.addEventListener('scroll', () => {
        bar.style.width = (html.scrollTop / (height- html.clientHeight)) * 100 + '%';
    });
});
</script>







<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Practice R Tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/edgar-treischl/PracticeR_Tutorials" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter_05.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Prepare categorical variables</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Base R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Exploration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data manipulation with dplyr</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_05.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Prepare categorical variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analyze data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualize data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Create tables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Automate work</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Collect data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#inspect-factors" id="toc-inspect-factors" class="nav-link active" data-scroll-target="#inspect-factors"><span class="header-section-number">4.1</span> Inspect factors</a></li>
  <li><a href="#change-the-order-of-levels" id="toc-change-the-order-of-levels" class="nav-link" data-scroll-target="#change-the-order-of-levels"><span class="header-section-number">4.2</span> Change the order of levels</a></li>
  <li><a href="#change-the-value-of-levels" id="toc-change-the-value-of-levels" class="nav-link" data-scroll-target="#change-the-value-of-levels"><span class="header-section-number">4.3</span> Change the value of levels</a></li>
  <li><a href="#add-or-drop-levels" id="toc-add-or-drop-levels" class="nav-link" data-scroll-target="#add-or-drop-levels"><span class="header-section-number">4.4</span> Add or drop levels</a></li>
  <li><a href="#further-steps" id="toc-further-steps" class="nav-link" data-scroll-target="#further-steps"><span class="header-section-number">4.5</span> Further steps</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">4.6</span> Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Prepare categorical variables</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Welcome to the data preparation tutorial of the <a href="https://www.degruyter.com/document/isbn/9783110704969/html?lang=de" title="Go to the website">Practice R</a> book <span class="citation" data-cites="treischl_practice_2023">(<a href="references.html#ref-treischl_practice_2023" role="doc-biblioref">Treischl 2023</a>)</span>. Practice R is a text book for the social sciences which provides several tutorials supporting students to learn R. Feel free to inspect the tutorials even if you are not familiar with the book, but keep in mind these tutorials are supposed to complement the Practice R book. <a href="https://forcats.tidyverse.org" target="_blank"><img src="https://github.com/tidyverse/forcats/raw/main/man/figures/logo.png" alt="The forcats package" align="right" width="100"></a></p>
<p>Chapter 5 was dedicated to support you to prepare data. We learned how to import, clean, and combine data. In addition, we got in touch with the <code>naniar</code> package which offers many functions to inspect missing values <span class="citation" data-cites="naniar">(<a href="references.html#ref-naniar" role="doc-biblioref">Tierney et al. 2021</a>)</span>; and I introduced the <code>forcats</code> package to prepare categorical variables for the analysis <span class="citation" data-cites="forcats">(<a href="references.html#ref-forcats" role="doc-biblioref">Wickham 2022</a>)</span>.</p>
<p>What preparation steps you need to apply is dependent on the data at hand and the analysis intended, which is why Chapter 5 provided a detailed overview of what happens under the hood when we import data. Keep in mind that RStudio has many cool features (e.g., data preview) to import data and packages such as <code>readr</code> helps us with this task:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import a csv file</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"path_to_the_file/data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since I have no idea what your data looks, this tutorial will not focus on how to import and clean data. Instead, let’s focus systematically on the <code>forcats</code> package. Suppose we started to analyze whether participant’s income has an effect on their happiness, but we need to control for participant’s educational background, religious beliefs, and if other categorical variables affect our estimation results. I already introduced several functions of the <code>forcats</code> package, but this tutorial systematically focuses on the main tasks of the package, as is outlined in its cheat sheet (click on the hex sticker to download the cheat sheet from the website).</p>
<p>Thus, we repeat and systematize our forcats skills: (1) We inspect factors; (2) change the order of levels; (3) change the value of levels; (4) and we add or drop levels. For this purpose, we use the <code>gss2016</code> data and I assigned a smaller subset as <code>df</code> with several categorical variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for Tutorial Nr. 5</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PracticeR)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The gss2016 data</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> PracticeR<span class="sc">::</span>gss2016 <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, degree, relig, income16, happy, marital)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 6
#&gt;      id degree         relig    income16         happy        marital      
#&gt;   &lt;dbl&gt; &lt;fct&gt;          &lt;fct&gt;    &lt;fct&gt;            &lt;fct&gt;        &lt;fct&gt;        
#&gt; 1     1 Bachelor       None     $170000 or over  Pretty Happy Married      
#&gt; 2     2 High School    None     $50000 to 59999  Pretty Happy Never Married
#&gt; 3     3 Bachelor       Catholic $75000 to $89999 Very Happy   Married      
#&gt; 4     4 High School    Catholic $170000 or over  Pretty Happy Married      
#&gt; 5     5 Graduate       None     $170000 or over  Very Happy   Married      
#&gt; 6     6 Junior College None     $60000 to 74999  Very Happy   Married</code></pre>
</div>
</div>
<p>Finally, we transform and combine data once more given that such steps are often necessary before we can start to prepare data. However, this time we examine how built-in data sets from the <code>tidyr</code> and the <code>dplyr</code> package make the first move a bit easier.</p>
<section id="inspect-factors" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="inspect-factors"><span class="header-section-number">4.1</span> Inspect factors</h2>
<p>Suppose we need to prepare several categorical variables, such as religion (<code>relig</code>) or marital status (<code>marital</code>), for an analysis. To inspect factors, count them with <code>fct_count()</code>.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count factor variable</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(df<span class="sc">$</span>marital)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 2
#&gt;   f                 n
#&gt;   &lt;fct&gt;         &lt;int&gt;
#&gt; 1 Married        1212
#&gt; 2 Widowed         251
#&gt; 3 Divorced        495
#&gt; 4 Separated       102
#&gt; 5 Never Married   806
#&gt; 6 &lt;NA&gt;              1</code></pre>
</div>
</div>
<p>Or examine the unique levels of a variable with the <code>fct_unique()</code> function:</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many unique levels do we observe</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_unique</span>(df<span class="sc">$</span>marital)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] Married       Widowed       Divorced      Separated     Never Married
#&gt; [6] &lt;NA&gt;         
#&gt; Levels: Married Widowed Divorced Separated Never Married</code></pre>
</div>
</div>
</section>
<section id="change-the-order-of-levels" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="change-the-order-of-levels"><span class="header-section-number">4.2</span> Change the order of levels</h2>
<p>The variable religion (<code>relig</code>) has 13 different levels. Let’s assume we want to control for the largest religious groups only in the analysis. Use the <code>fct_infreq()</code> function to identify how often each level appears.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fct_infreq: Reorder factor levels by frequency</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fct_infreq</span>(df<span class="sc">$</span>relig)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 14 × 2
#&gt;    f                           n
#&gt;    &lt;fct&gt;                   &lt;int&gt;
#&gt;  1 Protestant               1371
#&gt;  2 Catholic                  649
#&gt;  3 None                      619
#&gt;  4 Jewish                     51
#&gt;  5 Other                      44
#&gt;  6 Christian                  40
#&gt;  7 Buddhism                   21
#&gt;  8 Moslem/Islam               19
#&gt;  9 Hinduism                   13
#&gt; 10 Orthodox-Christian          7
#&gt; 11 Inter-Nondenominational     7
#&gt; 12 Other Eastern               4
#&gt; 13 Native American             4
#&gt; 14 &lt;NA&gt;                       18</code></pre>
</div>
</div>
<p>The <code>fct_infreq()</code> sorts them in order of their frequency, but note we can also order the levels by first appearance (<code>fct_inorder</code>) or in a numeric order (<code>fct_inseq</code>). As the next console illustrates, R sorts levels alphabetically, which is clearly not always a desirable default behavior. Use the <code>fct_inorder()</code> to sort them by appearance.</p>
<div class="cell" data-exercise="true" data-exercise.lines="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example factor</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "b" "c"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fct_inorder: Reorder factor levels by first appearance</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_inorder</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] b a c
#&gt; Levels: b a c</code></pre>
</div>
</div>
<p>Can you still remember how to manually relevel? Use the <code>fct_relevel()</code> and sort the level <code>Never Married</code> at the second position. You can provide a vector with level names or use the <code>after</code> option to change the position of the level.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relevel manually</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># f &lt;- fct_relevel(df$marital, c("Married", "Never Married"))</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fct_relevel</span>(df<span class="sc">$</span>marital, <span class="st">"Never Married"</span>, <span class="at">after =</span> <span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 2
#&gt;   f                 n
#&gt;   &lt;fct&gt;         &lt;int&gt;
#&gt; 1 Married        1212
#&gt; 2 Never Married   806
#&gt; 3 Widowed         251
#&gt; 4 Divorced        495
#&gt; 5 Separated       102
#&gt; 6 &lt;NA&gt;              1</code></pre>
</div>
</div>
<p>Sometimes we need to turn the order around. Reverse the order of the levels with <code>fct_rev()</code>.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fct_rev: Reverse order of factor levels</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fct_rev</span>(df<span class="sc">$</span>marital)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 2
#&gt;   f                 n
#&gt;   &lt;fct&gt;         &lt;int&gt;
#&gt; 1 Never Married   806
#&gt; 2 Separated       102
#&gt; 3 Divorced        495
#&gt; 4 Widowed         251
#&gt; 5 Married        1212
#&gt; 6 &lt;NA&gt;              1</code></pre>
</div>
</div>
</section>
<section id="change-the-value-of-levels" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="change-the-value-of-levels"><span class="header-section-number">4.3</span> Change the value of levels</h2>
<p>The <code>relig</code> variable has many levels and even has a category named <code>other</code>, since there are so many religious groups. The same logic applies the <code>fct_other()</code> function which collapses all levels but the one we actually need. Create a variable that includes the five largest groups only. Use the <code>fct_other()</code> function and tell R which variables to <code>keep</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="7">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a variable with the five largest, rest are others</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>relig5 <span class="ot">&lt;-</span> <span class="fu">fct_other</span>(df<span class="sc">$</span>relig,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">"Protestant"</span>, <span class="st">"Catholic"</span>, <span class="st">"None"</span>, <span class="st">"Jewish"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(df<span class="sc">$</span>relig5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 2
#&gt;   f              n
#&gt;   &lt;fct&gt;      &lt;int&gt;
#&gt; 1 Protestant  1371
#&gt; 2 Catholic     649
#&gt; 3 Jewish        51
#&gt; 4 None         619
#&gt; 5 Other        159
#&gt; 6 &lt;NA&gt;          18</code></pre>
</div>
</div>
<p>The <code>fct_other()</code> function includes in the code the used levels. If we are unconcerned about this information, you can use one of the <code>fct_lump()</code> functions. The function picks between different methods to lump together factor levels. Nowadays the authors recommend to use one of the specific <code>fct_lump_*</code> functions (<code>fct_lump_min</code>, <code>fct_lump_prop</code>, <code>fct_lump_lowfreq</code>) as outlined in the help file. In our case, use the <code>fct_lump_n()</code> function to lump together the most frequent (<code>n</code>) ones.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lump uncommon factor together levels into "other"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fct_lump_n</span>(df<span class="sc">$</span>relig, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">other_level =</span> <span class="st">"Further groups"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 7 × 2
#&gt;   f                  n
#&gt;   &lt;fct&gt;          &lt;int&gt;
#&gt; 1 Protestant      1371
#&gt; 2 Catholic         649
#&gt; 3 Jewish            51
#&gt; 4 None             619
#&gt; 5 Other             44
#&gt; 6 Further groups   115
#&gt; 7 &lt;NA&gt;              18</code></pre>
</div>
</div>
<p>Next, we are going to prepare the educational background. The variable <code>degree</code> includes several levels, as the console shows.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count degrees</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(df<span class="sc">$</span>degree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 2
#&gt;   f                  n
#&gt;   &lt;fct&gt;          &lt;int&gt;
#&gt; 1 Lt High School   328
#&gt; 2 High School     1461
#&gt; 3 Junior College   216
#&gt; 4 Bachelor         536
#&gt; 5 Graduate         318
#&gt; 6 &lt;NA&gt;               8</code></pre>
</div>
</div>
<p>We already used the <code>fct_recode()</code> function to change factor levels by hand. The lowest category of <code>degree</code> is called <em>less than high school</em> but the text label is confusing. Recode the variable, insert the new label in back ticks to replace the old label (<code>Lt High School</code>).</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fct_recode: Change factor levels by hand</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(df<span class="sc">$</span>degree, <span class="st">`</span><span class="at">Less than high school</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Lt High School"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 2
#&gt;   f                         n
#&gt;   &lt;fct&gt;                 &lt;int&gt;
#&gt; 1 Less than high school   328
#&gt; 2 High School            1461
#&gt; 3 Junior College          216
#&gt; 4 Bachelor                536
#&gt; 5 Graduate                318
#&gt; 6 &lt;NA&gt;                      8</code></pre>
</div>
</div>
<p>Suppose we want to control only if participants have a high educational background. Use the <code>fct_collapse()</code> function to create a binary dummy variable. The variable should indicate if a person’s educational background is low (<code>Lt High School</code>; <code>High School</code>, and <code>Junior College</code>) or high (<code>Bachelor</code> and <code>Graduate</code>).</p>
<div class="cell" data-exercise="true" data-exercise.lines="10">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapse factor variable</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>edu_dummy <span class="ot">&lt;-</span> <span class="fu">fct_collapse</span>(df<span class="sc">$</span>degree,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">low =</span> <span class="fu">c</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lt High School"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"High School"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Junior College"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">high =</span> <span class="fu">c</span>(<span class="st">"Bachelor"</span>, <span class="st">"Graduate"</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(df<span class="sc">$</span>edu_dummy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;   f         n
#&gt;   &lt;fct&gt; &lt;int&gt;
#&gt; 1 low    2005
#&gt; 2 high    854
#&gt; 3 &lt;NA&gt;      8</code></pre>
</div>
</div>
</section>
<section id="add-or-drop-levels" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="add-or-drop-levels"><span class="header-section-number">4.4</span> Add or drop levels</h2>
<p>As always, the <code>forcats</code> package has more to offer than I can outline. For example, suppose we observed the following <code>religion</code> variable.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># New religion variable</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>religion <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Protestant"</span>, <span class="st">"Jewish"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Protestant"</span>, <span class="st">"Jewish"</span>, <span class="st">"Catholic"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>religion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] Protestant Jewish     &lt;NA&gt;       &lt;NA&gt;      
#&gt; Levels: Protestant Jewish Catholic</code></pre>
</div>
</div>
<p>Did you notice that the variable has a level for <code>Catholic</code> even though we do not observe it. The <code>fct_expand()</code> can be used to expand levels, while the <code>fct_drop()</code> function helps us to get rid of unused levels.</p>
<div class="cell" data-exercise="true" data-exercise.setup="r12a">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unused levels</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_drop</span>(religion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] Protestant Jewish     &lt;NA&gt;       &lt;NA&gt;      
#&gt; Levels: Protestant Jewish</code></pre>
</div>
</div>
<p>Furthermore, I included missing values on purpose and the latter may have an impact on our analysis. We can make them explicit and include them as a level with <code>fct_na_value_to_level()</code>.</p>
<div class="cell" data-exercise="true" data-exercise.setup="r12a">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make NAs explicit</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_na_value_to_level</span>(religion, <span class="at">level =</span> <span class="st">"Missing"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] Protestant Jewish     Missing    Missing   
#&gt; Levels: Protestant Jewish Catholic Missing</code></pre>
</div>
</div>
</section>
<section id="further-steps" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="further-steps"><span class="header-section-number">4.5</span> Further steps</h2>
<p>Chapter 5 discussed many steps to prepare data, but of course this was not an all-encompassing list. I introduced data formats and we learned how to combine data given that many official data sets are split into several files. Unfortunately, transforming and combining data can be tricky and we may introduce mistakes if we neglected to prepare and clean the data properly. Thus, it is up to you to assure that the data can be transformed (combined) and further cleaning steps might be necessary.</p>
<p>Instead of re-running these steps with the <code>gss2016</code> data, let us explore how the <code>tidyr</code> package can help with the task <span class="citation" data-cites="tidyr">(<a href="references.html#ref-tidyr" role="doc-biblioref">Wickham and Girlich 2022</a>)</span>. As other packages, <code>tidyr</code> has a cheat sheet and provides a tiny data set that lets us repeat how the functions work. For example, the <code>table4a</code> data is a wide data set with observations of three countries and two years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example wide table</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(table4a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 3 × 3
#&gt;   country     `1999` `2000`
#&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan    745   2666
#&gt; 2 Brazil       37737  80488
#&gt; 3 China       212258 213766</code></pre>
</div>
</div>
<p>Use the <code>pivot_longer()</code> function to transform the data. The long data should have a new variable for the <code>year</code> (via <code>names_to</code>) and you can give the values (<code>values_to</code>) to a variable named <code>cases</code>.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make em longer</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(table4a,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"cases"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Afghanistan 2000    2666
#&gt; 3 Brazil      1999   37737
#&gt; 4 Brazil      2000   80488
#&gt; 5 China       1999  212258
#&gt; 6 China       2000  213766</code></pre>
</div>
</div>
<p>Or consider the <code>table2</code> data, the variable <code>type</code> has two outcome types (<code>cases</code> and <code>population</code>) which underline why we should transform the data into the wide format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example long table</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(table2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year type           count
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
#&gt; 1 Afghanistan  1999 cases            745
#&gt; 2 Afghanistan  1999 population  19987071
#&gt; 3 Afghanistan  2000 cases           2666
#&gt; 4 Afghanistan  2000 population  20595360
#&gt; 5 Brazil       1999 cases          37737
#&gt; 6 Brazil       1999 population 172006362</code></pre>
</div>
</div>
<p>Keep in mind that we need to provide <em>where</em> the names (<code>names_from</code>) and the values (<code>values_from</code>) are coming from to transform the data.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make it wider</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(table2,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> type,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> count</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year  cases population
#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Afghanistan  1999    745   19987071
#&gt; 2 Afghanistan  2000   2666   20595360
#&gt; 3 Brazil       1999  37737  172006362
#&gt; 4 Brazil       2000  80488  174504898
#&gt; 5 China        1999 212258 1272915272
#&gt; 6 China        2000 213766 1280428583</code></pre>
</div>
</div>
<p><a href="https://edgar-treischl.github.io/CopyCat/" target="_blank"><img src="https://edgar-treischl.github.io/CopyCat/logo.png" alt="The CopyCat package" align="right" width="15%" style="padding:10px"></a></p>
<p>I introduced these data sets because <code>tidyr</code> offers such simple examples in the cheat sheet that demonstrates how we can transform data. In addition, the <code>copycat</code> package has the code snippets from the <code>tidyverse</code> cheat sheets included. As the animation shows, it only takes a few seconds to insert these examples via the add-in. Start with such a simple example if you do not transform and combine data on a regular basis. After you made sure that the code works, adjust it for your purpose, but be careful how the data is transformed.</p>
<p><a href="https://edgar-treischl.github.io/CopyCat/" target="_blank"><img src="https://edgar-treischl.github.io/CopyCat/reference/figures/addin_animated.gif" alt="The CopyCat package" align="center" width="90%" style="padding:10px"></a></p>
<p>The same applies if you need to combine data. The <code>dplyr</code> also offers a small data set to practice mutating joins <span class="citation" data-cites="dplyr">(<a href="references.html#ref-dplyr" role="doc-biblioref">Wickham et al. 2022</a>)</span>. The <code>band_members</code> data includes <code>names</code> from members of two different music bands; and the <code>band_instruments</code> data includes their instruments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Small data to recapture the join_* functions</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>band_members</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;   name  band   
#&gt;   &lt;chr&gt; &lt;chr&gt;  
#&gt; 1 Mick  Stones 
#&gt; 2 John  Beatles
#&gt; 3 Paul  Beatles</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>band_instruments</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;   name  plays 
#&gt;   &lt;chr&gt; &lt;chr&gt; 
#&gt; 1 John  guitar
#&gt; 2 Paul  bass  
#&gt; 3 Keith guitar</code></pre>
</div>
</div>
<p>Use one of the <code>join</code> function (e.g., <code>inner_join</code>, <code>full_join</code>) to combine the data.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutating joins</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>band_members <span class="sc">|&gt;</span> <span class="fu">inner_join</span>(band_instruments, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 2 × 3
#&gt;   name  band    plays 
#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
#&gt; 1 John  Beatles guitar
#&gt; 2 Paul  Beatles bass</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>band_members <span class="sc">|&gt;</span> <span class="fu">full_join</span>(band_instruments, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 4 × 3
#&gt;   name  band    plays 
#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
#&gt; 1 Mick  Stones  &lt;NA&gt;  
#&gt; 2 John  Beatles guitar
#&gt; 3 Paul  Beatles bass  
#&gt; 4 Keith &lt;NA&gt;    guitar</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Further joins:</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># band_members |&gt; left_join(band_instruments)</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># band_members |&gt; right_join(band_instruments)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://naniar.njtierney.com" target="_blank"><img src="https://github.com/njtierney/naniar/raw/master/man/figures/logo.png" alt="The naniar package" align="right" width="100"></a></p>
<p>Finally, one last word about missing values: make sure you explore the data before you run an analysis, but don’t neglect to inspect missing and implausible values as well. The <code>naniar</code> package has a lot to offer for this task and of course I did not introduce everything it is capable of in Chapter 5. For example, we used the <code>vis_miss()</code> function to visualize missing values, but not the amount of missing values. Give the <code>gg_miss_var()</code> function a try. It returns a lollipop chart to visualize the amount of missing values. To display percentages, set the <code>show_pct</code> option to <code>TRUE</code>.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the amount of missing values</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(df, <span class="at">show_pct =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images/ch_05/r17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="summary" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.6</span> Summary</h2>
<p>In addition to the discussed content, keep the following R functions and packages in mind:</p>
<ul>
<li><p>Import data with different packages. For example:</p>
<ul>
<li>CSV with the <code>readr</code> package <span class="citation" data-cites="readr">(<a href="references.html#ref-readr" role="doc-biblioref">Wickham, Hester, and Bryan 2022</a>)</span></li>
<li>Excel with the <code>readxl</code> package <span class="citation" data-cites="readxl">(<a href="references.html#ref-readxl" role="doc-biblioref">Wickham and Bryan 2022</a>)</span></li>
<li>SPSS or Stata with the <code>haven</code> package <span class="citation" data-cites="haven">(<a href="references.html#ref-haven" role="doc-biblioref">Wickham, Miller, and Smith 2022</a>)</span></li>
</ul></li>
<li><p>Convert objects into numeric (character) vectors (<code>as.numeric, as.character</code>)</p></li>
<li><p>Rename columns (<code>dplyr::rename</code>)</p></li>
<li><p>Cleans names of an object <span class="citation" data-cites="janitor">(<code>janitor::clean_names</code>: <a href="references.html#ref-janitor" role="doc-biblioref">Firke 2021</a>)</span></p></li>
<li><p>Combine data:</p>
<ul>
<li>Pivot data from long to wide (<code>tidyr::pivot_wider</code>)</li>
<li>Pivot data from wide to long (<code>tidyr::pivot_longer</code>)</li>
<li>Mutating joins (<code>dplyr::inner_join, left_join, right_join, full_join</code>)</li>
<li>Filtering joins (<code>dplyr::semi_join, anti_join</code>)</li>
<li>Set pperations (<code>base::union, intersect, setdiff, setequal</code>)</li>
</ul></li>
<li><p>Missing (and implausible) values:</p>
<ul>
<li>The <code>naniar</code> package and its function to explore missing values (e.g., <code>n_miss, n_complete, vis_miss</code>)</li>
<li>Check if something is not available (e.g., <code>base::is.na</code>)</li>
<li>Convert values to NA (<code>dplyr::na_if</code>)</li>
<li>Drop rows containing missing values (<code>tidyr::drop_na</code>)</li>
<li>Replace NAs with specified values (<code>tidyr::replace_na</code>)</li>
</ul></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-janitor" class="csl-entry" role="listitem">
Firke, Sam. 2021. <em><span class="nocase">janitor: Simple Tools for Examining and Cleaning Dirty Data</span></em>. <a href="https://CRAN.R-project.org/package=janitor">https://CRAN.R-project.org/package=janitor</a>.
</div>
<div id="ref-naniar" class="csl-entry" role="listitem">
Tierney, Nicholas, Di Cook, Miles McBain, and Colin Fay. 2021. <em><span class="nocase">naniar: Data Structures, Summaries, and Visualisations for Missing Data</span></em>. <a href="https://CRAN.R-project.org/package=naniar">https://CRAN.R-project.org/package=naniar</a>.
</div>
<div id="ref-treischl_practice_2023" class="csl-entry" role="listitem">
Treischl, Edgar J. 2023. <em>Practice <span>R</span>: <span>An</span> Interactive Textbook</em>. De Gruyter Oldenbourg.
</div>
<div id="ref-forcats" class="csl-entry" role="listitem">
Wickham, Hadley. 2022. <em><span class="nocase">forcats: Tools for Working with Categorical Variables (Factors)</span></em>. <a href="https://CRAN.R-project.org/package=forcats">https://CRAN.R-project.org/package=forcats</a>.
</div>
<div id="ref-readxl" class="csl-entry" role="listitem">
Wickham, Hadley, and Jennifer Bryan. 2022. <em><span class="nocase">readxl: Read Excel Files</span></em>. <a href="https://CRAN.R-project.org/package=readxl">https://CRAN.R-project.org/package=readxl</a>.
</div>
<div id="ref-dplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2022. <em><span class="nocase">dplyr: A Grammar of Data Manipulation</span></em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-tidyr" class="csl-entry" role="listitem">
Wickham, Hadley, and Maximilian Girlich. 2022. <em><span class="nocase">tidyr: Tidy Messy Data</span></em>. <a href="https://CRAN.R-project.org/package=tidyr">https://CRAN.R-project.org/package=tidyr</a>.
</div>
<div id="ref-readr" class="csl-entry" role="listitem">
Wickham, Hadley, Jim Hester, and Jennifer Bryan. 2022. <em><span class="nocase">readr: Read Rectangular Text Data</span></em>. <a href="https://CRAN.R-project.org/package=readr">https://CRAN.R-project.org/package=readr</a>.
</div>
<div id="ref-haven" class="csl-entry" role="listitem">
Wickham, Hadley, Evan Miller, and Danny Smith. 2022. <em><span class="nocase">haven: Import and Export SPSS, Stata and SAS Files</span></em>. <a href="https://CRAN.R-project.org/package=haven">https://CRAN.R-project.org/package=haven</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_04.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data manipulation with dplyr</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_06.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analyze data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>